<div class = "container-fluid">
  <%= render 'shared/menu' %>
</div>

<div class = "container-fluid mt-3">
  <span><b>Trabajador:</b> <%= params[:NOMBRE] %> </span>
</div>
<div class="container-fluid">
  <%= render "forma_de_busqueda" %>
  <% if params[:mes].present? && params[:ano].present? %>
    <h5 class="text-center mt-2">Conceptos</h5>
    <table class="table">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Código</th>
          <th scope="col">Descripción</th>
          <th scope="col">Monto</th>
        </tr>
      </thead>
      <tbody>
      <% counter = 1 %>
      <% @nomina_mes.each do |concepto|%>
        <tr>
          <th scope="row"><%= counter %></th>
          <td><%= concepto.CO_CONCEPTO %></td>
          <td><%= concepto.DESCRIPCION_CO %></td>
          <td><%= concepto.MO_CONCEP %></td>
        </tr>
      <% counter += 1%>
      <% end %>
      </tbody>
    </table>
    <div class="container-fluid d-flex gap-3 justify-content-center">
      <div>
        <b>Primera Quincena: </b>
        <%= quincena_1  = @nomina_mes.find { |concepto| concepto.CO_CONCEPTO == 'X500' }.MO_CONCEP %>
      </div>
      <div>|</div>
      <div>
        <% conceptos_por_indices = @nomina_mes.group_by {|indice| indice[:INDICE_CONCEPTO]}  %>
        <% suma_conceptos = {} %>
        <% conceptos_por_indices.each do | indice, conceptos| %>
          <% suma_conceptos[indice] = conceptos.reduce(0) do |suma, concepto| %>
            <% suma + concepto.MO_CONCEP %>
          <% end %>
        <% end %>
        <% quincena_2 = suma_conceptos.values.first %>
        <% suma_conceptos.values[1..].each {|valor| quincena_2 -= valor } %>
        <b>Segunda Quincena: </b> <%= quincena_2 %>
      </div>
      <div>|</div>
      <div>
        <b>Total mes: </b>
        <%= quincena_1 + quincena_2 %>
      </div>
    </div>
<% else %>
  <div>
    <h2>Reailiza una búsqueda</h2>
  </div>
<% end %>
</div>


